name: Lazul OpenRouter Proxy
on:
  workflow_dispatch:  # Manual trigger
  repository_dispatch:
    types: [lazul-chat]

jobs:
  proxy:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Input
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Payload URL: ${{ github.event.client_payload.url }}"
          echo "Model: ${{ github.event.client_payload.model }}"
          
      - name: Proxy to OpenRouter
        run: |
          URL="${{ github.event.client_payload.url }}"
          BODY="${{ github.event.client_payload.body }}"
          KEY="${{ secrets.OPENROUTER_KEY }}"
          
          echo "Proxying $URL..."
          
          curl -X POST "$URL" \
            -H "Authorization: Bearer $KEY" \
            -H "Content-Type: application/json" \
            -H "HTTP-Referer: ${{ github.event.client_payload.referer }}" \
            -H "X-Title: Lazul" \
            --data "$BODY" \
            --silent \
            --fail || echo "Curl failed - check OPENROUTER_KEY secret"
